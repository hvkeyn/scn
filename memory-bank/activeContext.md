# Active Context: LocalSend

## Текущий фокус работы

Проект находится в активной разработке. Основные направления:

1. **Поддержка платформ** - обеспечение работы на всех целевых платформах
2. **Улучшение производительности** - оптимизация передачи файлов
3. **Расширение функциональности** - добавление новых возможностей
4. **Исправление багов** - поддержка стабильности

## Недавние изменения

Согласно CHANGELOG и версии (1.17.0+58), проект активно развивается. Основные области изменений:

- Обновления зависимостей
- Исправления багов
- Улучшения UI/UX
- Оптимизации производительности
- Добавление новых языков

## Следующие шаги

### Приоритетные задачи

1. **Стабильность**
   - Исправление известных багов
   - Улучшение обработки ошибок
   - Тестирование на разных платформах

2. **Производительность**
   - Оптимизация передачи больших файлов
   - Улучшение обнаружения устройств
   - Снижение использования памяти

3. **Функциональность**
   - Улучшение WebRTC поддержки
   - Расширение настроек безопасности
   - Улучшение истории передач

### Активные решения

#### Архитектурные решения

- **Refena для state management** - выбран для простоты и производительности
- **Rust для core логики** - для высокой производительности и безопасности
- **Flutter Rust Bridge** - для интеграции Rust и Flutter

#### Технические решения

- **HTTPS с самоподписанными сертификатами** - баланс между безопасностью и простотой
- **Multicast DNS** - для автоматического обнаружения устройств
- **Streaming передача** - для эффективной работы с большими файлами

## Текущие проблемы и ограничения

### Известные проблемы

1. **Android скорость передачи**
   - Известная проблема с saf_stream
   - Ссылка: https://github.com/flutter-cavalry/saf_stream/issues/4

2. **Сетевая изоляция**
   - Требуется отключение AP isolation на роутерах
   - Windows требует настройку сети как "частная"

3. **macOS/iOS разрешения**
   - Может потребоваться включение "Local Network" разрешения

### Технические ограничения

- Зависимость от локальной сети
- Требования к настройке файрвола
- Платформо-специфичные ограничения разрешений

## Области для улучшения

### Код

- Улучшение тестового покрытия
- Рефакторинг сложных компонентов
- Документация API

### UX

- Улучшение обработки ошибок для пользователя
- Более понятные сообщения об ошибках
- Улучшение onboarding процесса

### Производительность

- Оптимизация использования памяти
- Улучшение скорости обнаружения устройств
- Оптимизация передачи файлов

## Контекст разработки

### Workflow

1. Разработка ведется в основном репозитории
2. Используется Flutter через fvm для консистентности версий
3. Rust код компилируется через flutter_rust_bridge
4. Генерация кода через build_runner

### Тестирование

- Unit тесты в `app/test/`
- Тесты common библиотеки в `common/test/`
- Ручное тестирование на разных платформах

### Распространение

- Автоматическая сборка через CI/CD
- Распространение через различные каналы (App Store, Play Store, package managers)
- Поддержка portable режима

## Важные заметки

### Версионирование

- Формат: `MAJOR.MINOR.PATCH+BUILD`
- Текущая версия: 1.17.0+58

### Зависимости

- Некоторые зависимости используют git forks для исправлений
- `device_apps` - форк для поддержки Android
- `pasteboard` - временный форк
- `permission_handler_windows` - noop версия для Windows 7

### FOSS версия

- Проект имеет FOSS версию
- Некоторые функции помечены как `[FOSS_REMOVE]`
- In-app purchases удаляются в FOSS версии

